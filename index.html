<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ランダム単語抽出ツール（絞り込み対応）</title>
  <style>
    body { font-family: sans-serif; margin: 16px; }
    .nav { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 14px; }
    button { padding: 10px 14px; font-size: 1rem; width: auto; }
    .panel { margin-top: 12px; }
    .result { margin-top: 12px; padding: 10px; border: 1px solid #ccc; background: #f7f7f7; }

    input[type="number"] { padding: 10px; font-size: 1rem; width: 100%; box-sizing: border-box; }
    .grid { display: grid; gap: 10px; }

    /* 見やすいボックス形式 */
    .entry-box {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 8px 12px;
      margin-bottom: 12px;
      background: #fff;
    }
    .entry-name {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 6px;
    }
    .entry-type {
      background: #eef;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.8em;
      margin-left: 6px;
    }
    .entry-condition {
      background: #d0ebff;
      padding: 6px 8px;
      margin: 4px 0;
      border-radius: 4px;
    }
    .entry-desc {
      background: #fff3bf;
      padding: 6px 8px;
      margin: 4px 0;
      border-radius: 4px;
    }

    /* 単語のみゾーン用 */
    .word-card {
      font-weight: bold;
      font-size: 1.2em;
      background: #ff666685;
      border: 2px solid #000000;
      border-radius: 8px;
      padding: 10px 12px;
      margin: 6px 0;
      text-align: center;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }

    /* スマホ対応 */
    @media (max-width: 600px) {
      body { margin: 12px; }
      h1 { font-size: 1.4rem; }
      button { width: 100%; font-size: 1rem; padding: 12px; }
      .nav { flex-direction: column; gap: 10px; }
      .result { font-size: 0.95rem; }
      label { font-size: 1rem; }
      .word-card { font-size: 1.1em; padding: 8px 10px; }
    }
  </style>
</head>
<body>
<h1>ランダム単語抽出ツール</h1>

<div class="nav">
  <button type="button" onclick="showTab('randomTab')">ランダム生成</button>
  <button type="button" onclick="showTab('filterTab')">絞り込み</button>
  <button type="button" onclick="showTab('infoTab')">単語解説</button>
</div>

<div id="randomTab" class="panel" style="display:none;">
  <p class="mini">現在の抽選対象：<span id="activeCount">—</span> / <span id="totalCount">—</span></p>
  <p>抽出する個数：</p>
  <input type="number" id="countInput" min="1" value="1" />
  <br />
  <button type="button" onclick="pickWords()">抽出する</button>

  <!-- 単語のみ表示エリア -->
  <div class="result" id="wordListArea" style="margin-top:12px;"></div>

  <!-- 解説付き表示エリア -->
  <div class="result" id="resultArea" style="margin-top:12px;"></div>
</div>

<div id="filterTab" class="panel" style="display:none;">
  <h2>絞り込み</h2>
  <p>ランダム生成の対象にする単語にチェックを入れてください（初期は全選択）。</p>
  <div id="filterList" class="grid"></div>
  <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
    <button type="button" onclick="applyFilter()">絞り込みを適用</button>
    <button type="button" onclick="resetFilter()">リセット（全選択）</button>
  </div>
  <div class="result" id="filterResult"></div>
</div>

<div id="infoTab" class="panel" style="display:none;">
  <h2>単語の解説</h2>
  <div id="infoContent"></div>
</div>

<script>
const entries = [
  { name: "1,9萬シャッフル", type: "搔き回し", condition: "1,9萬を捨てた時", desc: "1,9萬を捨てた際に発動する。自分の手牌から牌を1枚選び、その後他プレイヤーの手牌から1枚ずつ選びそれぞれをランダムに入れ替える。リーチ者は選ばれない" },
      { name: "1,9索サーチ", type: "防御", condition: "1,9索を捨てた時", desc: "1,9索を捨てた際に発動する。牌をひとつ宣言し、他プレイヤーはその持っている枚数を宣言する。" },
      { name: "1,9筒スキップ", type: "搔き回し", condition: "1,9筒を捨てた時", desc: "1,9筒を捨てた際に発動する。次のプレイヤーの手番は飛ばされる。" },
      { name: "鳴き付与「ズン」", type: "鳴き付与", condition: "全家からの鳴き", desc: "同じ数字の牌であれば牌の種類に関係なく鳴くことができる。その面子は違う種類の牌が混じった刻子として処理される。チーと複合する。" },
      { name: "鳴き付与「チー」", type: "鳴き付与", condition: "上家からの鳴き", desc: "一般的なチー。ズンと複合する。" },
      { name: "鳴き付与「チョン」", type: "鳴き付与", condition: "全家からの鳴き", desc: "1枚の状態から他プレイヤーから出た同じ牌を2枚組として鳴くことができる。この際、鳴いた牌は頭として処理され、今後は4面子を作っていく。その後、チョンした牌をツモってきた際は加槓のように鳴いた牌に追加することができる。その後、1枚切り、3面子1雀頭を作っていく。チョンとポンが同時に発生された場合はポンが優先される。" },
      { name: "幻聴", type: "防御", condition: "他プレイヤーからのリーチ宣言時", desc: "他プレイヤーからリーチが入った際に、そのリーチが「両面」「愚形」「シャンポン」「多面張」「その他」のどれであるかを知ることができる。" },
      { name: "裏捨て", type: "防御", condition: "牌を捨てる時", desc: "牌を捨てる際裏向きで捨てることができる。この牌は自身のフリテンにならず、他プレイヤーから上がられたり鳴かれたりすることはない。この能力は1局のうち2回しか発動できない。" },
      { name: "テンパイ気配", type: "防御", condition: "常時", desc: "任意のタイミングで他プレイヤーがテンパイしているかどうかを知ることができる。能力を使うたびに、自分の手牌の１枚を開示しなければならない。開示していた牌を捨てた後も能力を使った回数分の牌は開示しておかなければならない。" },
      { name: "河六回し", type: "搔き回し", condition: "自分の河に6の倍数分牌を捨てた時", desc: "自分の河に6の倍数分牌を捨てた際に発動する。全てのプレイヤーは手牌から2枚選び右隣のプレイヤーに渡す。リーチ者は選ばれない。" },
      { name: "お引越し", type: "搔き回し", condition: "対子を連続で捨てた時", desc: "同じ牌を連続で捨てた際に発動する。自分を含むプレイヤーを2人選び、選ばれたプレイヤーは面子を交換する。面子がない場合「ない」と申告する。リーチ者も選ぶことができる。" },
      { name: "革命", type: "搔き回し", condition: "自分の河に同じ牌が4枚捨てられている時", desc: "自分の河に同じ牌が4枚揃った際に発動する。全てのプレイヤーは手牌を右隣のプレイヤーに渡す。鳴いてるプレイヤーやリーチ者も含まれる。リーチ者はリーチが解除され、鳴き牌も渡す。" },
      { name: "役牌ノ令", type: "搔き回し", condition: "自分の第一ツモ時", desc: "自分の第一ツモ時に牌をひとつ宣言する。それ以降、その牌は対子または暗刻、槓子の際に役牌として処理される。" },
      { name: "スタートダッシュ", type: "手牌強化", condition: "自分の第一ツモ時", desc: "第一ツモの際、ツモって捨てる行為を合計3回行える。その際、他プレイヤーから鳴かれると終了となる。" },
      { name: "合法多牌", type: "手牌強化", condition: "自分の第一ツモ時", desc: "第一ツモの後、もうひとつ牌をツモり多牌の状態で進行する。その後、任意のタイミングで2枚捨てる。多牌の状態から1枚捨てて上がることはできない。" },
      { name: "鳴き警察", type: "手牌強化", condition: "自分を含むプレイヤーが鳴いた時", desc: "自分を含む誰かが鳴いた際、次のツモ番が自分となる。" },
      { name: "シャンブルズ", type: "搔き回し", condition: "常時", desc: "任意のタイミングで河に捨てられている牌同士を入れ替えることができる。この能力は1局のうち1回しか発動できない。" },
      { name: "北リセット", type: "手牌強化", condition: "北を捨てた時", desc: "北を捨てた際に発動する。自分に鳴きが入っていた場合、鳴いている牌を1組だけ手牌に戻すことができる。槓子がある場合は暗槓になる。" },
      { name: "自風デュエル", type: "攻撃", condition: "リーチ時に自風の牌を捨てた時", desc: "自分のリーチ時のリーチ宣言牌が自風の際に発動する。リーチ宣言後、他プレイヤーの手牌を1枚引き、その牌があたり牌だった場合はそのプレイヤーにロンすることができ、一発も付与される。この行為を各プレイヤー2枚ずつ行える。" },
      { name: "アディショナルタイム", type: "攻撃", condition: "自分以外のプレイヤーが上がった時", desc: "自分以外の他プレイヤーが上がった際、自分がテンパイしていれば残りのツモ山から3枚追加で引くことができ、その牌で上がることができる。その際は2人上がったとして点数移動がされ、能力発動者が親だった場合親は継続される。" },
      { name: "カスタマイズ", type: "攻撃", condition: "自分のリーチ時", desc: "自分のリーチ中、テンパイを継続できているなら手牌を組み替えてもよい。" },
      { name: "ウノ捨て", type: "特殊", condition: "牌を捨てる時", desc: "2枚以上の同じ牌、または3枚以上の同じ種類の連番であれば同時に捨てることができる。捨てた枚数分次のツモ番にツモる。(例:4p4p4p,2s3s4s5s6s)" },
      { name: "字牌ボンバー", type: "防御", condition: "自分の河に字牌が5つ並んだ時", desc: "自分の河に字牌が5枚並んだ際に発動できる。牌をひとつ宣言し、自分も含む、その牌を持っていたプレイヤーは自分の河に捨て、能力発動者から順に捨てた分山からツモる。その際に捨てられた牌に関しては鳴くことも上がることもできない。" },
      { name: "暗転", type: "搔き回し", condition: "自風を捨てた時", desc: "自風を捨てた際に発動する。他プレイヤーはこのターンツモ牌を見ずに捨てる牌を選択し、捨てた後にツモ牌を確認する。(このターン:自分の次のツモ番までor鳴きが入った時点で終了)" },
      { name: "ドラ縛り", type: "搔き回し", condition: "ドラを捨てた時", desc: "ドラを切った際に発動する。他プレイヤーはこのターン捨てられたドラと同じ種類の牌を捨てなければならない。その際、手牌に同じ種類の牌がある場合は必ず、ない場合はツモ切りをする。(このターン:自分の次のツモ番までor鳴きが入った時点で終了)" },
];

let activeNames = entries.map(e => e.name);

function byName(name){ return entries.find(e => e.name === name); }

function updateRandomTargetSummary(){
  document.getElementById('totalCount').textContent = entries.length;
  document.getElementById('activeCount').textContent = activeNames.length;
}

function showTab(tabId){
  ['randomTab','filterTab','infoTab'].forEach(id=>{
    document.getElementById(id).style.display = (id===tabId)?'block':'none';
  });
  if(tabId==='filterTab') renderFilterList();
  if(tabId==='infoTab') renderInfoList();
  if(tabId==='randomTab') updateRandomTargetSummary();
}

// Fisher–Yatesシャッフルに置き換え
function shuffleArray(array){
  let arr = [...array];
  for(let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function pickWords(){
  const count = Number(document.getElementById('countInput').value);
  const result = document.getElementById('resultArea');
  const wordList = document.getElementById('wordListArea');

  if(!Number.isFinite(count) || count < 1){ 
    result.textContent = '個数は1以上の数値で指定してください。'; 
    wordList.textContent = '';
    return; 
  }
  if(activeNames.length === 0){ 
    result.textContent = '抽選対象がありません。'; 
    wordList.textContent = '';
    return; 
  }
  if(count > activeNames.length){ 
    result.textContent = `抽選対象が不足しています（対象: ${activeNames.length}）。`; 
    wordList.textContent = '';
    return; 
  }

  const shuffled = shuffleArray(activeNames);
  const selected = shuffled.slice(0, count);

  // 単語のみ表示
  let wordHtml = '';
  selected.forEach(name => {
    wordHtml += `<div class="word-card">${name}</div>`;
  });
  wordList.innerHTML = wordHtml;

  // 解説付き表示
  let html = '';
  selected.forEach(name=>{
    const e = byName(name);
    html += `
      <div class="entry-box">
        <div class="entry-name">${name}<span class="entry-type">${e.type}</span></div>
        <div class="entry-condition"><strong>発動条件:</strong> ${e.condition}</div>
        <div class="entry-desc"><strong>解説:</strong> ${e.desc}</div>
      </div>
    `;
  });
  result.innerHTML = html;
}

function renderFilterList(){
  const area = document.getElementById('filterList'); area.innerHTML='';
  entries.forEach((e,idx)=>{
    const id=`filter_${idx}`;
    const checked=activeNames.includes(e.name)?'checked':'';
    area.innerHTML += `<label style="display:block;margin:2px 0;">
      <input type="checkbox" id="${id}" value="${e.name}" ${checked}/> ${e.name}</label>`;
  });
}

function applyFilter(){
  activeNames = Array.from(document.querySelectorAll('#filterList input[type="checkbox"]:checked')).map(el=>el.value);
  document.getElementById('filterResult').textContent=`適用しました：対象 ${activeNames.length} / ${entries.length}`;
  updateRandomTargetSummary();
}

function resetFilter(){
  activeNames = entries.map(e => e.name);
  renderFilterList();
  document.getElementById('filterResult').textContent=`リセットしました：対象 ${activeNames.length} / ${entries.length}`;
  updateRandomTargetSummary();
}

function renderInfoList(){
  const box = document.getElementById('infoContent'); box.innerHTML='';
  entries.forEach(e=>{
    box.innerHTML += `
      <div class="entry-box">
        <div class="entry-name">${e.name}<span class="entry-type">${e.type}</span></div>
        <div class="entry-condition"><strong>発動条件:</strong> ${e.condition}</div>
        <div class="entry-desc"><strong>解説:</strong> ${e.desc}</div>
      </div>
    `;
  });
}

document.addEventListener('DOMContentLoaded',()=>{
  renderFilterList(); updateRandomTargetSummary(); showTab('randomTab');
});
</script>
</body>
</html>
